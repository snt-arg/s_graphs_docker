!function(s){"use strict";var r;redux.field_objects=redux.field_objects||{},redux.field_objects.media=redux.field_objects.media||{},redux.field_objects.media.init=function(e){e||(e=s(document).find(".redux-group-tab:visible").find(".redux-container-media:visible")),s(e).each(function(){var e=s(this),i=e;e.hasClass("redux-field-container")||(i=e.parents(".redux-field-container:first")),i.is(":hidden")||i.hasClass("redux-field-init")&&(i.removeClass("redux-field-init"),r=!1,e.find(".remove-image, .remove-file").unbind("click").on("click",function(){redux.field_objects.media.removeFile(s(this).parents("fieldset.redux-field:first"))}),e.find(".media_upload_button").unbind().on("click",function(e){redux.field_objects.media.addFile(e,s(this).parents("fieldset.redux-field:first"))}))})},redux.field_objects.media.addFile=function(e,n){var o;e.preventDefault();var d,i=s(this);if(o)o.open();else{var t=s(n).find(".library-filter").data("lib-filter");void 0!==t&&""!==t&&(d=[],r=!0,t=decodeURIComponent(t),t=JSON.parse(t),s.each(t,function(e,i){d.push(i)})),(o=wp.media({multiple:!1,library:{type:d},title:i.data("choose"),button:{text:i.data("update")}})).on("select",function(){var e=o.state().get("selection").first();o.close();var i=s(n).find(".data").data();if(void 0!==redux.field_objects.media&&void 0!==typeof redux.field_objects.media||(redux.field_objects.media={}),void 0!==i&&"undefined"!==i.mode||(i={mode:"image"}),!0===r&&(i.mode=0),0===i.mode);else if(!1!==i.mode&&e.attributes.type!==i.mode&&e.attributes.subtype!==i.mode)return;console.log(e),n.find(".upload").val(e.attributes.url),n.find(".upload-id").val(e.attributes.id),n.find(".upload-height").val(e.attributes.height),n.find(".upload-width").val(e.attributes.width),n.find(".upload-title").val(e.attributes.title),n.find(".upload-caption").val(e.attributes.caption),n.find(".upload-alt").val(e.attributes.alt),n.find(".upload-description").val(e.attributes.description),redux_change(s(n).find(".upload-id"));var d=e.attributes.url;if(void 0!==e.attributes.sizes&&void 0!==e.attributes.sizes.thumbnail)d=e.attributes.sizes.thumbnail.url;else if(void 0!==e.attributes.sizes){var t=e.attributes.height;for(var a in e.attributes.sizes){var l=e.attributes.sizes[a];l.height<t&&(t=l.height,d=l.url)}}else d=e.attributes.icon;n.find(".upload-thumbnail").val(d),n.find(".upload").hasClass("noPreview")||n.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+d+'">').slideDown("fast"),n.find(".remove-image").removeClass("hide"),n.find(".redux-background-properties").slideDown()}),o.open()}},redux.field_objects.media.removeFile=function(e){e.find(".remove-image").addClass("hide")&&(e.find(".remove-image").addClass("hide"),e.find(".upload").val(""),e.find(".upload-id").val(""),e.find(".upload-height").val(""),e.find(".upload-width").val(""),e.find(".upload-title").val(""),e.find(".upload-caption").val(""),e.find(".upload-alt").val(""),e.find(".upload-description").val(""),e.find(".upload-thumbnail").val(""),redux_change(s(e).find(".upload-id")),e.find(".redux-background-properties").hide(),e.find(".screenshot").slideUp(),e.find(".remove-file").unbind(),0<e.find(".section-upload .upload-notice").length&&e.find(".media_upload_button").remove())}}(jQuery);